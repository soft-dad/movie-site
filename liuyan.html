<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="stylesheet" href="./css/reset.css">
	<link rel="stylesheet" href="./css/common.css">
	<link rel="stylesheet" href="./css/index.css"> <!-- ç¡®ä¿å¯¼èˆªæ ·å¼ç»Ÿä¸€ -->
	<title>åé¦ˆ</title>
</head>

<body class="day">
<!-- èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨ -->
<audio id="backgroundMusic" loop>
	<source src="music/background_music.mp3" type="audio/mpeg">
	æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
</audio>

<!-- ç‚¹å‡»éŸ³æ•ˆæ’­æ”¾å™¨ï¼ˆæå‰åŠ è½½ï¼Œç¡®ä¿æ— å»¶è¿Ÿï¼‰ -->
<audio id="clickSound" preload="auto">
	<source src="music/click.mp3" type="audio/mpeg">
	æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
</audio>

<!-- éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
<button id="musicToggle" style="
    position: fixed; top: 100px; right: 20px; z-index: 1000;
    padding: 10px; cursor: pointer; background-color: rgba(0,0,0,0.5);
    color: white; border: none; border-radius: 5px;
">
	ğŸ”Š æ’­æ”¾éŸ³ä¹
</button>

<script>
	document.addEventListener('DOMContentLoaded', function() {
		const music = document.getElementById('backgroundMusic');
		const toggleButton = document.getElementById('musicToggle');
		const clickSound = document.getElementById('clickSound');
		const SOUND_MIN_DURATION = 200;

		// ç®€åŒ–çš„éŸ³é¢‘æ£€æŸ¥å‡½æ•°
		function checkAudioAvailability() {
			// æ£€æŸ¥èƒŒæ™¯éŸ³ä¹
			if (music.error) {
				console.error('èƒŒæ™¯éŸ³ä¹é”™è¯¯:', music.error);
				toggleButton.textContent = 'ğŸ”Š éŸ³ä¹æ–‡ä»¶é”™è¯¯';
			}

			// æ£€æŸ¥ç‚¹å‡»éŸ³æ•ˆ
			if (clickSound.error) {
				console.error('ç‚¹å‡»éŸ³æ•ˆé”™è¯¯:', clickSound.error);
			}
		}

		// æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆçš„ç®€åŒ–ç‰ˆæœ¬
		function playClickSound() {
			return new Promise(resolve => {
				// æ— è®ºå¦‚ä½•éƒ½åœ¨æœ€çŸ­æ—¶é—´åresolveï¼Œç¡®ä¿äº¤äº’ä¸å¡é¡¿
				setTimeout(resolve, SOUND_MIN_DURATION);

				// å°è¯•æ’­æ”¾éŸ³æ•ˆ
				if (clickSound && clickSound.readyState >= 2) {
					clickSound.currentTime = 0;
					clickSound.play().catch(e => console.log('éŸ³æ•ˆæ’­æ”¾å¤±è´¥:', e));
				}
			});
		}

		// èƒŒæ™¯éŸ³ä¹æ§åˆ¶
		toggleButton.addEventListener('click', function() {
			// å…ˆæ’­æ”¾ç‚¹å‡»éŸ³æ•ˆï¼Œå†åˆ‡æ¢èƒŒæ™¯éŸ³ä¹çŠ¶æ€
			playClickSound().then(() => {
				if (music.paused) {
					music.play()
						.then(() => toggleButton.textContent = 'ğŸ”‡ å…³é—­éŸ³ä¹')
						.catch(e => {
							console.log('éŸ³ä¹æ’­æ”¾å¤±è´¥:', e);
							alert('éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨');
						});
				} else {
					music.pause();
					toggleButton.textContent = 'ğŸ”Š æ’­æ”¾éŸ³ä¹';
				}
			});
		});

		// ä¸ºæ‰€æœ‰å¯ç‚¹å‡»å…ƒç´ æ·»åŠ éŸ³æ•ˆ
		document.querySelectorAll('a, button, input[type="button"], input[type="submit"]').forEach(element => {
			// æ’é™¤éŸ³ä¹æŒ‰é’®ï¼Œå› ä¸ºå·²ç»å•ç‹¬å¤„ç†
			if (element.id !== 'musicToggle') {
				element.addEventListener('click', function(e) {
					// å¯¹é“¾æ¥ç‰¹æ®Šå¤„ç†ï¼Œé˜²æ­¢ç«‹å³è·³è½¬
					if (this.tagName === 'A' && this.href && !this.href.includes('#')) {
						e.preventDefault();
						const href = this.href;
						const target = this.target;

						playClickSound().then(() => {
							if (target === '_blank') {
								window.open(href, '_blank');
							} else {
								window.location.href = href;
							}
						});
					} else {
						// æ™®é€šæŒ‰é’®åªæ’­æ”¾éŸ³æ•ˆ
						playClickSound();
					}
				});
			}
		});

		// åˆå§‹åŒ–ä¸‹æ‹‰èœå•ï¼ˆä¿ç•™åŸæœ‰åŠŸèƒ½ï¼‰
		function initDropdownMenus() {
			const dropdowns = document.querySelectorAll('.dropdown');

			dropdowns.forEach(dropdown => {
				const dropbtn = dropdown.querySelector('.dropbtn');
				const dropdownContent = dropdown.querySelector('.dropdown-content');

				if (dropbtn && dropdownContent) {
					const dropdownItems = dropdownContent.querySelectorAll('a');
					dropdownItems.forEach(item => {
						item.addEventListener('click', function(e) {
							e.stopPropagation();
							const href = this.getAttribute('href');
							playClickSound().then(() => {
								window.location.href = href;
							});
						});
					});

					if (window.innerWidth < 768) {
						dropbtn.addEventListener('click', function(e) {
							e.preventDefault();
							dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
						});
					}

					/* ç‚¹å‡»éŸ³æ•ˆï¼šæ’é™¤éŸ³ä¹æŒ‰é’®ï¼Œé¿å…æ‰“æ–­èƒŒæ™¯éŸ³ä¹ */
document.addEventListener('mousedown', (e) => {
  if (e.target.id === 'musicToggle') return;          // â† æ’é™¤éŸ³ä¹æŒ‰é’®
  const clickSound = document.getElementById('clickSound');
  if (!clickSound) return;
  clickSound.currentTime = 0;
  clickSound.play().catch(() => {});
}, { capture: true });
					});
				}
			});
		}

		// æœç´¢æŒ‰é’®å¤„ç†
		const searchSubmit = document.querySelector('.serch-form .submit');
		if (searchSubmit) {
			searchSubmit.addEventListener('click', function(e) {
				const input = document.querySelector('.serch-form .search');
				if (!input.value.trim()) {
					e.preventDefault();
					alert('è¯·è¾“å…¥æœç´¢å†…å®¹');
				}
			});
		}

		// åˆ‡æ¢èƒŒæ™¯æŒ‰é’®å¤„ç†
		const changeBgBtn = document.querySelector('#tool .c4');
		if (changeBgBtn) {
			changeBgBtn.addEventListener('click', function() {
				playClickSound().then(() => {
					if (typeof changeBg === 'function') {
						changeBg();
					} else {
						document.body.classList.toggle('day');
						document.body.classList.toggle('night');
					}
				});
			});
		}

		// åˆå§‹åŒ–
		checkAudioAvailability();
		initDropdownMenus();
	});
</script>

<!-- å¤´éƒ¨å¯¼èˆª -->
<!-- å¤´éƒ¨å¯¼èˆª -->
<nav class="header">
	<div class="contain">
		<!-- logoåŒº -->
		<a href="./index.html" class="logo"></a>
		<!-- åˆ—è¡¨ -->
		<ul>
			<li><a href="./index.html">é¦–é¡µ</a></li>
			<li class="dropdown">
				<a href="./movie.html" class="dropbtn">ç”µå½±</a>
				<div class="dropdown-content">
					<a href="category_Action.html">åŠ¨ä½œç‰‡</a>
					<a href="category_Comedy.html">å–œå‰§ç‰‡</a>
					<a href="category_Romance.html">çˆ±æƒ…ç‰‡</a>
					<a href="category_Sci-fic.html">ç§‘å¹»ç‰‡</a>
				</div>
			</li>
			<li><a href="./cinema.html">å½±é™¢</a></li>
			<li class="dropdown">
				<a href="./liuyan.html" class="dropbtn">åé¦ˆ</a>
				<div class="dropdown-content">
					<a href="liuyan_tel.html">ç”µè¯å®¢æœ</a>
					<a href="liuyan.html">ç³»ç»Ÿç•™è¨€</a>
					<a href="liuyan_feedback.html">æ„è§åé¦ˆ</a>
					<a href="liuyan_about.html">å…³äºæˆ‘ä»¬</a>
				</div>
			</li>
			<li><a href="./mall.html">å•†åŸ</a></li>
		</ul>
		<!-- ç”¨æˆ·ç™»å…¥ -->
		<div class="userinfo">
			<img src="./img/userifo.png" alt="ç”¨æˆ·">
			<a href="./login.html" style="margin-left: 20px;">ç™»å½•</a>
		</div>
		<!-- æœç´¢åŒº -->
		<form action="#" class="serch-form" method="POST">
			<input type="search" class="search" placeholder="æ‰¾å½±è§†å‰§ å½±äºº å½±é™¢">
			<input type="submit" class="submit" value="">
		</form>
		<!-- appä¸‹è½½ -->
		<div class="appdownload">
			<a href="#">
				<span class="iphone-icon"></span>
				<span class="apptext">appä¸‹è½½</span>
				<span class="caret"></span>
				<div class="downloadicon">
					<p class="down-title">æ‰«ç ä¸‹è½½app</p>
					<p class="down-content">é€‰åº§æ›´ä¼˜æƒ </p>
				</div>
			</a>
		</div>
	</div>
</nav>

<!-- ===== æ–°ç‰ˆç•™è¨€æ¿ ===== -->
<section class="msg-section">
	<div class="msg-card">
		<div class="msg-header">
			<div class="nick-area">
				<span class="nick-label">æ˜µç§°</span>
				<input id="ritian" type="text" value="åŒ¿åç”¨æˆ·" readonly>
				<button id="changeNick" class="btn-text">ä¿®æ”¹</button>
			</div>
			<div class="char-circle">
				<svg width="60" height="60">
					<circle cx="30" cy="30" r="26" stroke="#e2e2e2" stroke-width="4" fill="none"></circle>
					<circle id="progress" cx="30" cy="30" r="26" stroke="#042A8F" stroke-width="4" fill="none"
							stroke-dasharray="163" stroke-dashoffset="163"></circle>
				</svg>
				<span id="charPercent" class="circle-text">100%</span>
			</div>
		</div>

		<textarea id="messageInput" maxlength="200" placeholder="å†™ä¸‹ä½ çš„ç•™è¨€å§ï½"></textarea>

		<div class="msg-toolbar">
			<span class="char-tip">è¿˜å¯è¾“å…¥ <strong id="remainingChars">200</strong> å­—</span>
			<div class="btn-group">
				<button id="clearBt" class="btn-secondary">æ¸…ç©º</button>
				<button id="postBt" class="btn-primary">å‘è¡¨ç•™è¨€</button>
			</div>
		</div>
	</div>

	<!-- ç•™è¨€åˆ—è¡¨ -->
	<div id="comment" class="comment-list"></div>
</section>

<!-- ç»Ÿä¸€åº•éƒ¨ -->
<div class="footer">â€¦</div>

<!-- ===== æ–°æ ·å¼ ===== -->
<style>
	.msg-section{
		min-height: 100vh;
		background: linear-gradient(135deg,#f5f7fa 0%, #c3cfe2 100%);
		padding: 30px 20px 60px;
		margin-top: 80px;          /* é¿å¼€ fixed å¯¼èˆª */
		display: flex;
		flex-direction: column;
		align-items: center;
	}
	.msg-card{
		width: 100%;
		max-width: 800px;
		background: #fff;
		border-radius: 12px;
		box-shadow: 0 10px 25px rgba(0,0,0,.08);
		padding: 25px 30px 35px;
		margin-bottom: 30px;
	}
	.msg-header{
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 15px;
	}
	.nick-area{
		display: flex;
		align-items: center;
		gap: 10px;
	}
	.nick-label{
		font-size: 15px;
		color: #666;
	}
	#ritian{
		border: 1px solid #d8d8d8;
		border-radius: 4px;
		padding: 5px 8px;
		width: 140px;
		font-size: 14px;
		color: #333;
		background: #fafafa;
	}
	.btn-text{
		border: none;
		background: none;
		color: #042A8F;
		cursor: pointer;
		font-size: 14px;
	}
	.btn-text:hover{
		text-decoration: underline;
	}
	.char-circle{
		position: relative;
	}
	.circle-text{
		position: absolute;
		left: 50%;
		top: 50%;
		transform: translate(-50%,-50%);
		font-size: 13px;
		color: #042A8F;
	}
	#messageInput{
		width: 100%;
		height: 140px;
		border: 1px solid #d8d8d8;
		border-radius: 8px;
		padding: 12px;
		font-size: 15px;
		resize: vertical;
		transition: border .3s;
	}
	#messageInput:focus{
		border-color: #042A8F;
		outline: none;
	}
	.msg-toolbar{
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-top: 12px;
	}
	.char-tip{
		font-size: 13px;
		color: #999;
	}
	.btn-group{
		display: flex;
		gap: 10px;
	}
	.btn-primary,.btn-secondary{
		padding: 7px 18px;
		border: none;
		border-radius: 4px;
		font-size: 14px;
		cursor: pointer;
		transition: all .3s;
	}
	.btn-primary{
		background: #042A8F;
		color: #fff;
	}
	.btn-primary:hover{
		background: #0648c4;
	}
	.btn-secondary{
		background: #f0f0f0;
		color: #333;
	}
	.btn-secondary:hover{
		background: #e0e0e0;
	}
	.comment-list{
		width: 100%;
		max-width: 800px;
	}
	.comment-item{
		background: #fff;
		border-radius: 8px;
		padding: 18px 22px;
		margin-bottom: 15px;
		box-shadow: 0 4px 12px rgba(0,0,0,.05);
		display: flex;
		justify-content: space-between;
		align-items: flex-start;
	}
	.comment-main{
		flex: 1;
	}
	.comment-nick{
		font-size: 15px;
		color: #042A8F;
		margin-bottom: 6px;
	}
	.comment-time{
		font-size: 12px;
		color: #999;
		margin-bottom: 8px;
	}
	.comment-txt{
		font-size: 15px;
		line-height: 1.6;
		color: #333;
	}
	.comment-del{
		border: none;
		background: none;
		color: #999;
		cursor: pointer;
		font-size: 13px;
	}
	.comment-del:hover{
		color: #f40;
	}
	/* æ°”æ³¡èƒŒæ™¯ */
	.msg-section::before{
		content: '';
		position: fixed;
		width: 200px;
		height: 200px;
		background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Ccircle fill='%23d8e0ff' cx='100' cy='100' r='90'/%3E%3C/svg%3E") center/contain no-repeat;
		opacity: .15;
		animation: float 18s infinite ease-in-out;
	}
	@keyframes float{
		0%,100%{transform: translateY(0) rotate(0deg);}
		50%{transform: translateY(-30px) rotate(180deg);}
	}
</style>

<!-- ===== æ–°é€»è¾‘ ===== -->
<script>
	/* ç»Ÿä¸€éŸ³ä¹é€»è¾‘ï¼ˆä¸ movie.html å®Œå…¨ä¸€è‡´ï¼‰ */
	document.addEventListener('DOMContentLoaded', () => {
		const music = document.getElementById('backgroundMusic');
		const toggleBtn = document.getElementById('musicToggle');
		const clickSound = document.getElementById('clickSound');
		const isPlaying = localStorage.getItem('musicPlaying') === 'true';
		if (isPlaying) {
			music.play().then(() => toggleBtn.textContent = 'ğŸ”‡ å…³é—­éŸ³ä¹').catch(() => {});
		}
		toggleBtn.addEventListener('click', () => {
			if (music.paused) {
				music.play().then(() => {
					toggleBtn.textContent = 'ğŸ”‡ å…³é—­éŸ³ä¹';
					localStorage.setItem('musicPlaying', 'true');
				}).catch(() => toggleBtn.textContent = 'ğŸ”Š è¯·ç‚¹å‡»æˆ‘æ’­æ”¾éŸ³ä¹');
			} else {
				music.pause();
				toggleBtn.textContent = 'ğŸ”Š æ’­æ”¾éŸ³ä¹';
				localStorage.setItem('musicPlaying', 'false');
			}
		});
		document.addEventListener('mousedown', () => {
			clickSound.currentTime = 0;
			clickSound.play().catch(() => {});
		}, { capture: true });
	});

	/* å­—ç¬¦åœ†ç¯ & è®¡æ•° */
	const input = document.getElementById('messageInput');
	const progress = document.getElementById('progress');
	const charPercent = document.getElementById('charPercent');
	const remainingChars = document.getElementById('remainingChars');
	const maxLen = 200;
	function updateCircle() {
		const len = input.value.length;
		const percent = Math.max(0, Math.floor((maxLen - len) / maxLen * 100));
		const offset = 163 - (163 * percent / 100);
		progress.style.strokeDashoffset = offset;
		charPercent.textContent = percent + '%';
		remainingChars.textContent = maxLen - len;
	}
	input.addEventListener('input', updateCircle);
	updateCircle();

	/* æ˜µç§°ä¿®æ”¹ */
	document.getElementById('changeNick').addEventListener('click', () => {
		const nick = prompt('è¯·è¾“å…¥æ–°æ˜µç§°ï¼š') || 'åŒ¿åç”¨æˆ·';
		document.getElementById('ritian').value = nick;
	});

	/* å‘è¡¨ & æ¸…ç©º */
	document.getElementById('postBt').addEventListener('click', () => {
		if (!input.value.trim()) return alert('ç•™è¨€å†…å®¹ä¸èƒ½ä¸ºç©ºï¼');
		// è¿™é‡Œè°ƒç”¨ä½ åŸæœ‰çš„ Storage.saveData() å³å¯
		Storage.saveData();
		input.value = '';
		updateCircle();
	});
	document.getElementById('clearBt').addEventListener('click', () => {
		if (confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰ç•™è¨€ï¼Ÿ')) Storage.clearData();
	});

	/* æ²¿ç”¨ä½ åŸæœ‰çš„ localStorage å­˜å‚¨é€»è¾‘ */
	var Storage = {
		saveData() {
			const data = input.value, nick = document.getElementById('ritian').value;
			const time = new Date().getTime() + Math.random() * 5;
			localStorage.setItem(time, `${data}|${nick}|${this.getDateTime()}`);
			this.writeData();
		},
		clearData() {
			localStorage.clear();
			this.writeData();
		},
		writeData() {
			let html = '';
			for (let i = localStorage.length - 1; i >= 0; i--) {
				const [txt, nick, dt] = localStorage.getItem(localStorage.key(i)).split('|');
				html += `<div class="comment-item">
                        <div class="comment-main">
                            <div class="comment-nick">${nick}</div>
                            <div class="comment-time">${dt}</div>
                            <div class="comment-txt">${txt}</div>
                        </div>
                        <button class="comment-del" onclick="Storage.del('${localStorage.key(i)}')">åˆ é™¤</button>
                     </div>`;
			}
			document.getElementById('comment').innerHTML = html || '<p style="text-align:center;color:#999;">æš‚æ— ç•™è¨€</p>';
		},
		del(key) { localStorage.removeItem(key); this.writeData(); },
		getDateTime() {
			const d = new Date();
			const pad = n => n < 10 ? '0' + n : n;
			return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}`;
		}
	};
	window.onload = () => Storage.writeData();
</script>
</body>
</body>
</html>
