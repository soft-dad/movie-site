<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>正在热映--电影</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/movie.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="css/pager.css">
    <style>
        .dropdown{position:relative;}
        .dropdown-content{
            position:absolute;top:100%;left:0;min-width:140px;background:#fff;
            box-shadow:0 2px 8px rgba(0,0,0,.15);visibility:hidden;opacity:0;
            transition:opacity .2s;pointer-events:auto;z-index:9999;
        }
        .dropdown:hover>.dropdown-content{visibility:visible;opacity:1;}
        .dropdown-content a{display:block;padding:10px 14px;color:#333;text-decoration:none;white-space:nowrap;}
        .dropdown-content a:hover{background:#f1f1f1;}
        .nav .tab.active{color:#ff6900;}
        .tab-content{display:none;}
        .tab-content.active{display:block;}
    </style>
</head>
<body class="day">

<!-- 音频 -->
<audio id="backgroundMusic" loop><source src="music/background_music.mp3" type="audio/mpeg"></audio>
<audio id="clickSound" preload="auto"><source src="music/click.mp3" type="audio/mpeg"></audio>
<button id="musicToggle" style="position:fixed;top:100px;right:20px;z-index:1000;padding:10px;cursor:pointer;background:rgba(0,0,0,.5);color:#fff;border:none;border-radius:5px;">🔊 播放音乐</button>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const music = document.getElementById('backgroundMusic');
        const toggleButton = document.getElementById('musicToggle');
        const clickSound = document.getElementById('clickSound');
        const SOUND_MIN_DURATION = 200;

        // 简化的音频检查函数
        function checkAudioAvailability() {
            // 检查背景音乐
            if (music.error) {
                console.error('背景音乐错误:', music.error);
                toggleButton.textContent = '🔊 音乐文件错误';
            }

            // 检查点击音效
            if (clickSound.error) {
                console.error('点击音效错误:', clickSound.error);
            }
        }

        // 播放点击音效的简化版本
        function playClickSound() {
            return new Promise(resolve => {
                // 无论如何都在最短时间后resolve，确保交互不卡顿
                setTimeout(resolve, SOUND_MIN_DURATION);

                // 尝试播放音效
                if (clickSound && clickSound.readyState >= 2) {
                    clickSound.currentTime = 0;
                    clickSound.play().catch(e => console.log('音效播放失败:', e));
                }
            });
        }

        // 背景音乐控制
        toggleButton.addEventListener('click', function() {
            // 先播放点击音效，再切换背景音乐状态
            playClickSound().then(() => {
                if (music.paused) {
                    music.play()
                        .then(() => toggleButton.textContent = '🔇 关闭音乐')
                        .catch(e => {
                            console.log('音乐播放失败:', e);
                            alert('音乐播放失败，请检查文件是否存在');
                        });
                } else {
                    music.pause();
                    toggleButton.textContent = '🔊 播放音乐';
                }
            });
        });

        // 为所有可点击元素添加音效
        document.querySelectorAll('a, button, input[type="button"], input[type="submit"]').forEach(element => {
            // 排除音乐按钮，因为已经单独处理
            if (element.id !== 'musicToggle') {
                element.addEventListener('click', function(e) {
                    // 对链接特殊处理，防止立即跳转
                    if (this.tagName === 'A' && this.href && !this.href.includes('#')) {
                        e.preventDefault();
                        const href = this.href;
                        const target = this.target;

                        playClickSound().then(() => {
                            if (target === '_blank') {
                                window.open(href, '_blank');
                            } else {
                                window.location.href = href;
                            }
                        });
                    } else {
                        // 普通按钮只播放音效
                        playClickSound();
                    }
                });
            }
        });

        // 初始化下拉菜单（保留原有功能）
        function initDropdownMenus() {
            const dropdowns = document.querySelectorAll('.dropdown');

            dropdowns.forEach(dropdown => {
                const dropbtn = dropdown.querySelector('.dropbtn');
                const dropdownContent = dropdown.querySelector('.dropdown-content');

                if (dropbtn && dropdownContent) {
                    const dropdownItems = dropdownContent.querySelectorAll('a');
                    dropdownItems.forEach(item => {
                        item.addEventListener('click', function(e) {
                            e.stopPropagation();
                            const href = this.getAttribute('href');
                            playClickSound().then(() => {
                                window.location.href = href;
                            });
                        });
                    });

                    if (window.innerWidth < 768) {
                        dropbtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
                        });
                    }

                    document.addEventListener('click', function(e) {
                        if (!dropdown.contains(e.target)) {
                            dropdownContent.style.display = 'none';
                        }
                    });
                }
            });
        }

        // 搜索按钮处理
        const searchSubmit = document.querySelector('.serch-form .submit');
        if (searchSubmit) {
            searchSubmit.addEventListener('click', function(e) {
                const input = document.querySelector('.serch-form .search');
                if (!input.value.trim()) {
                    e.preventDefault();
                    alert('请输入搜索内容');
                }
            });
        }

        // 切换背景按钮处理
        const changeBgBtn = document.querySelector('#tool .c4');
        if (changeBgBtn) {
            changeBgBtn.addEventListener('click', function() {
                playClickSound().then(() => {
                    if (typeof changeBg === 'function') {
                        changeBg();
                    } else {
                        document.body.classList.toggle('day');
                        document.body.classList.toggle('night');
                    }
                });
            });
        }

        // 初始化
        checkAudioAvailability();
        initDropdownMenus();
    });
    document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('.tab');
        const contents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', function (e) {
                e.preventDefault(); // 阻止默认跳转

                const target = this.dataset.target;

                // 切换标签样式
                tabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                // 切换内容显示
                contents.forEach(c => c.classList.remove('active'));
                const targetContent = document.getElementById(target);
                if (targetContent) {
                    targetContent.classList.add('active');
                }
            });
        });
    });

</script>
<!-- 导航 -->
<nav class="header">
    <div class="contain">
        <a href="./index.html" class="logo"></a>
        <ul>
            <li><a href="./index.html">首页</a></li>
            <li class="dropdown">
                <a href="./movie.html" class="dropbtn">电影</a>
                <div class="dropdown-content">
                    <a href="category_Action.html">动作片</a>
                    <a href="category_Comedy.html">喜剧片</a>
                    <a href="category_Romance.html">爱情片</a>
                    <a href="category_Sci-fic.html">科幻片</a>
                </div>
            </li>
            <li><a href="./cinema.html">影院</a></li>
            <li class="dropdown">
                <a href="./liuyan.html" class="dropbtn">反馈</a>
                <div class="dropdown-content">
                    <a href="liuyan_tel.html">电话客服</a>
                    <a href="./liuyan.html">系统留言</a>
                    <a href="liuyan_feedback.html">意见反馈</a>
                    <a href="liuyan_about.html">关于我们</a>
                </div>
            </li>
            <li><a href="./mall.html">商城</a></li>
        </ul>
        <div class="userinfo">
            <img src="./img/userifo.png" alt="用户">
            <a href="./login.html" style="margin-left: 20px;">登录</a>
        </div>
        <form action="#" class="serch-form" method="POST">
            <input type="search" class="search" placeholder="找影视剧 影人 影院">
            <input type="submit" class="submit" value="">
        </form>
        <div class="appdownload">
            <a href="#">
                <span class="iphone-icon"></span>
                <span class="apptext">app下载</span>
                <span class="caret"></span>
                <div class="downloadicon">
                    <p class="down-title">扫码下载app</p>
                    <p class="down-content">选座更优惠</p>
                </div>
            </a>
        </div>
    </div>
</nav>

<!-- 主体 -->
<div class="main">
    <nav class="nav">
        <a href="?tab=tab1" class="tab active" data-target="tab1">正在热映</a>
        <a href="?tab=tab2" class="tab" data-target="tab2">即将上映</a>
        <a href="?tab=tab3" class="tab" data-target="tab3">经典影片</a>
    </nav>

    <!-- 正在热映 -->
    <div class="container tab-content active" id="tab1">
        <div class="choose-area">
            <div class="choose-item clearfix">
                <div class="left">类型：</div>
                <div class="right">
                    <ul class="clearfix">
                        <li class="select"><a href="">全部</a></li>
                        <li><a href="">爱情</a></li>
                        <li><a href="">喜剧</a></li>
                        <li><a href="">动画</a></li>
                        <li><a href="">剧情</a></li>
                        <li><a href="">恐怖</a></li>
                        <li><a href="">惊悚</a></li>
                        <li><a href="">科幻</a></li>
                        <li><a href="">动作</a></li>
                        <li><a href="">悬疑</a></li>
                        <li><a href="">犯罪</a></li>
                        <li><a href="">冒险</a></li>
                        <li><a href="">战争</a></li>
                        <li><a href="">奇幻</a></li>
                        <li><a href="">运动</a></li>
                        <li><a href="">家庭</a></li>
                        <li><a href="">古装</a></li>
                        <li><a href="">武侠</a></li>
                        <li><a href="">西部</a></li>
                        <li><a href="">历史</a></li>
                        <li><a href="">传记</a></li>
                        <li><a href="">歌舞</a></li>
                        <li><a href="">短片</a></li>
                        <li><a href="">纪录片</a></li>
                        <li><a href="">其他</a></li>
                    </ul>
                </div>
            </div>
            <div class="choose-item clearfix">
                <div class="left">地区：</div>
                <div class="right">
                    <ul class="clearfix">
                        <li class="select"><a href="">全部</a></li><li><a href="">大陆</a></li><li><a href="">美国</a></li><li><a href="">韩国</a></li><li><a href="">日本</a></li><li><a href="">中国香港</a></li><li><a href="">中国台湾</a></li><li><a href="">泰国</a></li><li><a href="">印度</a></li><li><a href="">法国</a></li><li><a href="">英国</a></li><li><a href="">俄罗斯</a></li><li><a href="">意大利</a></li><li><a href="">西班牙</a></li><li><a href="">德国</a></li><li><a href="">波兰</a></li><li><a href="">澳大利亚</a></li><li><a href="">伊朗</a></li><li><a href="">其他</a></li>
                    </ul>
                </div>
            </div>
            <div class="choose-item clearfix no-line">
                <div class="left">年代：</div>
                <div class="right">
                    <ul class="clearfix">
                        <li class="select"><a href="">全部</a></li><li><a href="">2024</a></li><li><a href="">2023</a></li><li><a href="">2022</a></li><li><a href="">2021</a></li><li><a href="">2020</a></li><li><a href="">2019</a></li><li><a href="">2018</a></li><li><a href="">2017</a></li><li><a href="">2016</a></li><li><a href="">2000-2015</a></li><li><a href="">90年代</a></li><li><a href="">80年代</a></li><li><a href="">70年代</a></li><li><a href="">60年代</a></li><li><a href="">更早</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="movies" id="movies-hot"></div>
        <div class="pager"></div>
    </div>

    <!-- 即将上映 -->
    <div class="container tab-content" id="tab2">
        <div class="choose-area">
            <div class="choose-item clearfix">
                <div class="left">类型：</div>
                <div class="right">
                    <ul class="clearfix">
                        <li class="select"><a href="">全部</a></li>
                        <li><a href="">爱情</a></li>
                        <li><a href="">喜剧</a></li>
                        <li><a href="">动画</a></li>
                        <li><a href="">剧情</a></li>
                        <li><a href="">恐怖</a></li>
                        <li><a href="">惊悚</a></li>
                        <li><a href="">科幻</a></li>
                        <li><a href="">动作</a></li>
                        <li><a href="">悬疑</a></li>
                        <li><a href="">犯罪</a></li>
                        <li><a href="">冒险</a></li>
                        <li><a href="">战争</a></li>
                        <li><a href="">奇幻</a></li>
                        <li><a href="">运动</a></li>
                        <li><a href="">家庭</a></li>
                        <li><a href="">古装</a></li>
                        <li><a href="">武侠</a></li>
                        <li><a href="">西部</a></li>
                        <li><a href="">历史</a></li>
                        <li><a href="">传记</a></li>
                        <li><a href="">歌舞</a></li>
                        <li><a href="">短片</a></li>
                        <li><a href="">纪录片</a></li>
                        <li><a href="">其他</a></li>
                    </ul>
                </div>
            </div>
            <div class="choose-item clearfix">
                <div class="left">地区：</div>
                <div class="right">
                    <ul class="clearfix">
                        <li class="select"><a href="">全部</a></li><li><a href="">大陆</a></li><li><a href="">美国</a></li><li><a href="">韩国</a></li><li><a href="">日本</a></li><li><a href="">中国香港</a></li><li><a href="">中国台湾</a></li><li><a href="">泰国</a></li><li><a href="">印度</a></li><li><a href="">法国</a></li><li><a href="">英国</a></li><li><a href="">俄罗斯</a></li><li><a href="">意大利</a></li><li><a href="">西班牙</a></li><li><a href="">德国</a></li><li><a href="">波兰</a></li><li><a href="">澳大利亚</a></li><li><a href="">伊朗</a></li><li><a href="">其他</a></li>
                    </ul>
                </div>
            </div>
            <div class="choose-item clearfix no-line">
                <div class="left">年代：</div>
                <div class="right">
                    <ul class="clearfix">
                        <li class="select"><a href="">全部</a></li><li><a href="">2024</a></li><li><a href="">2023</a></li><li><a href="">2022</a></li><li><a href="">2021</a></li><li><a href="">2020</a></li><li><a href="">2019</a></li><li><a href="">2018</a></li><li><a href="">2017</a></li><li><a href="">2016</a></li><li><a href="">2000-2015</a></li><li><a href="">90年代</a></li><li><a href="">80年代</a></li><li><a href="">70年代</a></li><li><a href="">60年代</a></li><li><a href="">更早</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="movies" id="movies-soon"></div>
        <div class="pager"></div>
    </div>

    <!-- 经典影片 -->
    <div class="container tab-content" id="tab3">
        <div class="choose-area">
            <div class="choose-item clearfix">
                <div class="left">类型：</div>
                <div class="right">
                    <ul class="clearfix">
                        <li class="select"><a href="">全部</a></li>
                        <li><a href="">爱情</a></li>
                        <li><a href="">喜剧</a></li>
                        <li><a href="">动画</a></li>
                        <li><a href="">剧情</a></li>
                        <li><a href="">恐怖</a></li>
                        <li><a href="">惊悚</a></li>
                        <li><a href="">科幻</a></li>
                        <li><a href="">动作</a></li>
                        <li><a href="">悬疑</a></li>
                        <li><a href="">犯罪</a></li>
                        <li><a href="">冒险</a></li>
                        <li><a href="">战争</a></li>
                        <li><a href="">奇幻</a></li>
                        <li><a href="">运动</a></li>
                        <li><a href="">家庭</a></li>
                        <li><a href="">古装</a></li>
                        <li><a href="">武侠</a></li>
                        <li><a href="">西部</a></li>
                        <li><a href="">历史</a></li>
                        <li><a href="">传记</a></li>
                        <li><a href="">歌舞</a></li>
                        <li><a href="">短片</a></li>
                        <li><a href="">纪录片</a></li>
                        <li><a href="">其他</a></li>
                    </ul>
                </div>
            </div>
            <div class="choose-item clearfix">
                <div class="left">地区：</div>
                <div class="right">
                    <ul class="clearfix">
                        <li class="select"><a href="">全部</a></li><li><a href="">大陆</a></li><li><a href="">美国</a></li><li><a href="">韩国</a></li><li><a href="">日本</a></li><li><a href="">中国香港</a></li><li><a href="">中国台湾</a></li><li><a href="">泰国</a></li><li><a href="">印度</a></li><li><a href="">法国</a></li><li><a href="">英国</a></li><li><a href="">俄罗斯</a></li><li><a href="">意大利</a></li><li><a href="">西班牙</a></li><li><a href="">德国</a></li><li><a href="">波兰</a></li><li><a href="">澳大利亚</a></li><li><a href="">伊朗</a></li><li><a href="">其他</a></li>
                    </ul>
                </div>
            </div>
            <div class="choose-item clearfix no-line">
                <div class="left">年代：</div>
                <div class="right">
                    <ul class="clearfix">
                        <li class="select"><a href="">全部</a></li><li><a href="">2024</a></li><li><a href="">2023</a></li><li><a href="">2022</a></li><li><a href="">2021</a></li><li><a href="">2020</a></li><li><a href="">2019</a></li><li><a href="">2018</a></li><li><a href="">2017</a></li><li><a href="">2016</a></li><li><a href="">2000-2015</a></li><li><a href="">90年代</a></li><li><a href="">80年代</a></li><li><a href="">70年代</a></li><li><a href="">60年代</a></li><li><a href="">更早</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="movies" id="movies-classic"></div>
        <div class="pager"></div>
    </div>
</div>

<!-- 底栏 -->
<div class="footer">
    <p>商务合作邮箱：v@longteng.com 客服电话：10105335 违法和不良信息举报电话：4006019900</p>
    <p>用户投诉邮箱：tousujubao@meituan.com 舞弊线索举报邮箱：wubijubao@longteng.com</p>
    <p><a>中华人民共和国增值电信业务经营许可证 京B2-20190350</a><span>|</span><a>营业性演出许可证 京演（机构）（2024）4094号</a></p>
    <p><a>广播电视节目制作经营许可证 （京）字第08478号</a><span>|</span><a>网络文化经营许可证 京网文（2024）3837-369号</a></p>
    <p><a>用户服务协议</a><span>|</span><a>平台交易规则总则</a><span>|</span><a>隐私政策</a></p>
    <p><a>京公网安备 11010102003232号</a></p>
    <p>©2024 电影 longteng.com</p>
    <p class="last"><a><img src="./img/network.png" alt=""></a><a><img src="./img/license.png" alt=""></a></p>
</div>

<script src="./js/pager.js"></script>
<script>
    /* ========== 新增：tab 切换逻辑 ========== */
    (function(){
        // 读 URL 参数
        function getParam(k){ return new URLSearchParams(location.search).get(k); }
        // 高亮标签 + 显示对应容器
        function switchTab(){
            const tabId = getParam('tab') || 'tab1';           // 默认 tab1
            document.querySelectorAll('.nav .tab').forEach(a=>a.classList.toggle('active',a.dataset.target===tabId));
            document.querySelectorAll('.tab-content').forEach(div=>div.classList.toggle('active',div.id===tabId));
        }
        // 页面首次加载 + 浏览器前进/后退时
        switchTab();
        window.addEventListener('popstate', switchTab);

        // 给标签加音效 & 阻止默认跳转（我们已经用 URL 控制）
        document.querySelectorAll('.nav .tab').forEach(a=>{
            a.addEventListener('click',function(e){
                // 音效
                const clickSound = document.getElementById('clickSound');
                if(clickSound){ clickSound.currentTime=0; clickSound.play().catch(()=>{}); }
                // 不写 href 也能切，但为了 URL 一致保留
            });
        });
    })();
</script>
</body>
</html>