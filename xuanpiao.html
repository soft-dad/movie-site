<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è´­ä¹°ç”µå½±ç¥¨ - 2å·å…</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/index.css">
    <link rel="stylesheet" href="./css/common.css">
    <link rel="stylesheet" href="./css/xuanpiao.css">
    <style>


        /* ç§»åŠ¨è®¾å¤‡é€‚é… */
        @media (max-width: 768px) {
            .dropdown-content {
                position: static;
                box-shadow: none;
            }
            .main-content {
                flex-direction: column;
            }
            .order-section {
                flex: 0 0 auto;
                width: 100%;
            }
            .seat-list {
                grid-template-columns: repeat(8, 32px);
                gap: 8px;
                padding: 16px;
            }
            .seat-item {
                width: 32px;
                height: 32px;
                font-size: 11px;
            }
            .legend-container {
                gap: 16px;
                padding: 10px 16px;
            }
            .header .contain {
                flex-wrap: wrap;
            }
            .header .serch-form,
            .header .appdownload {
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body class="day">
<!-- èƒŒæ™¯éŸ³ä¹æ’­æ”¾å™¨ -->
<audio id="backgroundMusic" loop preload="auto">
    <source src="./music/background_music.mp3" type="audio/mpeg">
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
</audio>
<!-- ç‚¹å‡»éŸ³æ•ˆæ’­æ”¾å™¨ -->
<audio id="clickSound" preload="auto">
    <source src="./music/click.mp3" type="audio/mpeg">
    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚

   </audio>
<!-- éŸ³ä¹æ§åˆ¶æŒ‰é’®ï¼šå¼±åŒ–è®¾è®¡ï¼Œä¸æŠ¢ç„¦ç‚¹ -->
<button id="musicToggle" class="music-control">
    <span>ğŸ”Š</span>
    <span class="music-text">æ’­æ”¾éŸ³ä¹</span>
</button>

<!-- å¤´éƒ¨å¯¼èˆª -->
<nav class="header" id="#">
    <div class="contain">
        <!-- logoåŒº -->
        <a href="./index.html" class="logo"></a>
        <!-- åˆ—è¡¨ -->
        <ul>
            <li><a href="./index.html">é¦–é¡µ</a></li>
            <!-- ä¿®æ”¹ç”µå½±ä¸‹æ‹‰èœå•ç»“æ„ï¼Œå¢åŠ ä¸“ç”¨ç±»å -->
            <li class="dropdown movie-dropdown">
                <a href="./movie.html" class="dropbtn">ç”µå½±</a>
                <div class="dropdown-content">
                    <a href="./category_Action.html">åŠ¨ä½œç‰‡</a>
                    <a href="./category_Comedy.html">å–œå‰§ç‰‡</a>
                    <a href="./category_Romance.html">çˆ±æƒ…ç‰‡</a>
                    <a href="./category_Sci-fic.html">ç§‘å¹»ç‰‡</a>
                </div>
            </li>
            <li><a href="./cinema.html">å½±é™¢</a></li>
            <li class="dropdown">
                <a href="./liuyan.html" class="dropbtn">åé¦ˆ</a>
                <div class="dropdown-content">
                    <a href="liuyan_tel.html">ç”µè¯å®¢æœ</a>
                    <a href="liuyan.html">ç³»ç»Ÿç•™è¨€</a>
                    <a href="liuyan_feedback.html">æ„è§åé¦ˆ</a>
                    <a href="liuyan_about.html">å…³äºæˆ‘ä»¬</a>
                </div>
            </li>
            <li><a href="./mall.html">å•†åŸ</a></li>
        </ul>
        <!-- ç”¨æˆ·ç™»å…¥ -->
        <div class="userinfo">
            <img src="./img/userifo.png" alt="ç”¨æˆ·">
            <a href="./login.html" style="margin-left: 20px;">ç™»å½•</a>
        </div>
        <!-- æœç´¢åŒº -->
        <form action="#" class="serch-form" method="POST">
            <input type="search" class="search" placeholder="æ‰¾å½±è§†å‰§ å½±äºº å½±é™¢">
            <input type="button" class="submit" value="">
        </form>
        <!-- appä¸‹è½½ -->
        <div class="appdownload">
            <a href="#">
                <span class="iphone-icon"></span>
                <span class="apptext">appä¸‹è½½</span>
                <span class="caret"></span>
                <div class="downloadicon">
                    <p class="down-title">æ‰«ç ä¸‹è½½app</p>
                    <p class="down-content">é€‰åº§æ›´ä¼˜æƒ </p>
                </div>
            </a>
        </div>
    </div>
</nav>

<div class="page-container">
    <div class="main-content">
        <!-- å·¦ä¾§é€‰åº§åŒºåŸŸ -->
        <div class="seat-section">
            <!-- é“¶å¹•+å“ç‰Œä¿¡æ¯ -->
            <div class="screen-container">
                <br>
                <br>
                <br>
                <br>
                <div class="screen-title">2å·å… é“¶å¹•</div>
                <div class="screen-area">æ”¾æ˜ åŒºåŸŸï¼ˆè¯·å¯¹å·å…¥åº§ï¼‰</div>
                <div class="best-view-tip">æœ€ä½³è§‚å½±åŒºï¼šBæ’ - Cæ’</div>
            </div>
            <!-- é¢œè‰²å›¾ä¾‹ -->
            <div class="legend-container">
                <div class="legend-item">
                    <div class="legend-color available"></div>
                    <span>å¯é€‰åº§ä½</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color selected"></div>
                    <span>å·²é€‰åº§ä½</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color sold"></div>
                    <span>å·²å”®åº§ä½</span>
                </div>
            </div>
            <!-- åº§ä½åˆ—è¡¨ -->
            <ul class="seat-list" id="seatList"></ul>
        </div>
        <!-- å³ä¾§è®¢å•åŒºåŸŸ -->
        <div class="order-section">
            <div class="order-card">
                <br>
                <br>
                <br>
                <br>
                <br>
                <br>
                <div class="order-header">è®¢å•ä¿¡æ¯</div>
                <div class="order-body">
                    <div class="order-info">
                        <div class="info-row">
                            <span class="info-label">å½±ç‰‡</span>
                            <span class="info-value">ã€Šå†°é›ªå¥‡ç¼˜2ã€‹</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">å½±å…</span>
                            <span class="info-value">2å·å…</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ—¶é—´</span>
                            <span class="info-value">12æœˆ1æ—¥ 21:00</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ç¥¨ä»·</span>
                            <span class="info-value">50å…ƒ/å¼ </span>
                        </div>
                    </div>
                    <div class="order-divider"></div>
                    <div class="order-info">
                        <div class="info-row">
                            <span class="info-label">å·²é€‰åº§ä½</span>
                            <span class="info-value seat-value" id="seatNumbers">æœªé€‰æ‹©</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">ç¥¨æ•°</span>
                            <span class="info-value" id="ticketCount">0å¼ </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">æ€»è®¡</span>
                            <span class="info-value price-value" id="totalPrice">Â¥0</span>
                        </div>
                    </div>
                    <button class="buy-btn" id="buyTicket">ç¡®è®¤è´­ä¹°</button>
                </div>
            </div>
        </div>
    </div>
</div>

<br>
<br>
<br>
<br>
<br>
<br>
<br>

<!-- åº•éƒ¨ -->
<div class="footer">
    <p>å•†åŠ¡åˆä½œé‚®ç®±ï¼šv@longteng.com å®¢æœç”µè¯ï¼š10105335 è¿æ³•å’Œä¸è‰¯ä¿¡æ¯ä¸¾æŠ¥ç”µè¯ï¼š4006019900 </p>
    <p>ç”¨æˆ·æŠ•è¯‰é‚®ç®±ï¼štousujubao@meituan.com èˆå¼Šçº¿ç´¢ä¸¾æŠ¥é‚®ç®±ï¼šwubijubao@longteng.com </p>
    <p>
        <a>ä¸­åäººæ°‘å…±å’Œå›½å¢å€¼ç”µä¿¡ä¸šåŠ¡ç»è¥è®¸å¯è¯ äº¬B2-20190350 </a>
        <span>|</span>
        <a> è¥ä¸šæ€§æ¼”å‡ºè®¸å¯è¯ äº¬æ¼”ï¼ˆæœºæ„ï¼‰ï¼ˆ2024ï¼‰4094å·</a>
    </p>
    <p>
        <a>å¹¿æ’­ç”µè§†èŠ‚ç›®åˆ¶ä½œç»è¥è®¸å¯è¯ ï¼ˆäº¬ï¼‰å­—ç¬¬08478å· </a>
        <span>|</span>
        <a> ç½‘ç»œæ–‡åŒ–ç»è¥è®¸å¯è¯ äº¬ç½‘æ–‡ï¼ˆ2024ï¼‰3837-369å·</a>
    </p>
    <p>
        <a>ç”¨æˆ·æœåŠ¡åè®® </a>
        <span>|</span>
        <a> å¹³å°äº¤æ˜“è§„åˆ™æ€»åˆ™</a>
        <span>|</span>
        <a>éšç§æ”¿ç­–</a>
    </p>
    <p><a>äº¬å…¬ç½‘å®‰å¤‡ 11010102003232å·</a></p>
    <p>æ–‡åŒ–ä¼ åª’æœ‰é™å…¬å¸</p>
    <p>Â©2024 ç”µå½± longteng.com</p>
    <p class="last">
        <a><img src="./img/network.png" alt=""></a>
        <a><img src="./img/license.png" alt=""></a>
    </p>
</div>

<script>
    // 1. DOMå…ƒç´ è·å–
    const backgroundMusic = document.getElementById('backgroundMusic');
    const clickSound = document.getElementById('clickSound');
    const musicToggle = document.getElementById('musicToggle');
    const musicText = musicToggle.querySelector('.music-text');
    const buyButton = document.getElementById('buyTicket');
    const seatNumbers = document.getElementById('seatNumbers');
    const ticketCount = document.getElementById('ticketCount');
    const totalPrice = document.getElementById('totalPrice');
    const seatList = document.getElementById('seatList');
    const homeLink = document.getElementById('homeLink');

    // 2. éŸ³ä¹æ§åˆ¶ï¼šä¼˜åŒ–äº¤äº’åé¦ˆ
    function initMusic() {
        const isPlaying = localStorage.getItem('musicPlaying') === 'true';
        const currentTime = parseFloat(localStorage.getItem('musicTime') || 0);

        // æ¢å¤æ’­æ”¾çŠ¶æ€
        if (currentTime > 0 && !isNaN(currentTime)) {
            backgroundMusic.currentTime = currentTime;
        }
        if (isPlaying) {
            backgroundMusic.play().then(() => {
                musicToggle.querySelector('span').textContent = 'ğŸ”‡';
                musicText.textContent = 'å…³é—­éŸ³ä¹';
            }).catch(err => {
                console.log('éŸ³ä¹è‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:', err);
                musicToggle.querySelector('span').textContent = 'ğŸ”Š';
                musicText.textContent = 'æ’­æ”¾éŸ³ä¹';
            });
        }

        // éŸ³ä¹æ§åˆ¶æŒ‰é’®äº‹ä»¶
        musicToggle.addEventListener('click', () => {
            if (backgroundMusic.paused) {
                backgroundMusic.play().then(() => {
                    musicToggle.querySelector('span').textContent = 'ğŸ”‡';
                    musicText.textContent = 'å…³é—­éŸ³ä¹';
                    localStorage.setItem('musicPlaying', 'true');
                }).catch(error => {
                    console.log("éŸ³ä¹æ’­æ”¾å¤±è´¥ï¼Œéœ€è¦ç”¨æˆ·äº¤äº’:", error);
                    musicToggle.querySelector('span').textContent = 'ğŸ”Š';
                    musicText.textContent = 'è¯·ç‚¹å‡»æˆ‘æ’­æ”¾éŸ³ä¹';
                });
            } else {
                backgroundMusic.pause();
                musicToggle.querySelector('span').textContent = 'ğŸ”Š';
                musicText.textContent = 'æ’­æ”¾éŸ³ä¹';
                localStorage.setItem('musicPlaying', 'false');
            }
        });

        // å®šæ—¶ä¿å­˜æ’­æ”¾è¿›åº¦
        setInterval(() => {
            if (!backgroundMusic.paused) {
                localStorage.setItem('musicTime', backgroundMusic.currentTime.toString());
            }
        }, 1000);
    }

    // 3. å…¨å±€ç‚¹å‡»éŸ³æ•ˆ
    function playClickSound() {
        try {
            // æ¯æ¬¡æ’­æ”¾å‰é‡ç½®éŸ³é¢‘ä½ç½®ï¼Œé¿å…è¿ç»­ç‚¹å‡»éŸ³æ•ˆå åŠ 
            clickSound.currentTime = 0;
            // æ’­æ”¾éŸ³æ•ˆï¼Œæ•è·æµè§ˆå™¨ç­–ç•¥é™åˆ¶é”™è¯¯
            clickSound.play().catch(error => {
                if (error.name === 'NotAllowedError') {
                    console.log("é¦–æ¬¡ç‚¹å‡»éœ€å…ˆæ¿€æ´»é¡µé¢ï¼ˆæµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾ç­–ç•¥é™åˆ¶ï¼‰ï¼Œå†æ¬¡ç‚¹å‡»å³å¯æ­£å¸¸æ’­æ”¾");
                } else {
                    console.log("ç‚¹å‡»éŸ³æ•ˆæ’­æ”¾å¼‚å¸¸:", error);
                }
            });
        } catch (e) {
            console.log("éŸ³æ•ˆæ–‡ä»¶åŠ è½½å¼‚å¸¸:", e);
        }
    }

    // å…¨å±€ç»‘å®šç‚¹å‡»éŸ³æ•ˆï¼ˆè¦†ç›–æ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬åŠ¨æ€å…ƒç´ ï¼‰
    function initGlobalClickSound() {
        // æ–¹å¼1ï¼šç»™documentç»‘å®šmousedownäº‹ä»¶ï¼ˆåº•å±‚äº‹ä»¶ï¼Œä¸è¢«å…ƒç´ æ‹¦æˆªï¼‰
        document.addEventListener('mousedown', playClickSound, { capture: true });

        // æ–¹å¼2ï¼šç›‘å¬åŠ¨æ€æ·»åŠ çš„å…ƒç´ ï¼ˆé˜²æ­¢åˆ†é¡µåŠ è½½ç­‰åœºæ™¯é—æ¼ï¼‰
        const observer = new MutationObserver(mutations => {
            mutations.forEach(mutation => {
                mutation.addedNodes.forEach(node => {
                    // ä»…å¯¹HTMLå…ƒç´ èŠ‚ç‚¹ç»‘å®šäº‹ä»¶
                    if (node.nodeType === 1) {
                        node.addEventListener('mousedown', playClickSound, { capture: true });
                    }
                });
            });
        });
        // ç›‘å¬bodyä¸‹æ‰€æœ‰å…ƒç´ å˜åŒ–ï¼ˆåŒ…æ‹¬å­æ ‘ï¼‰
        observer.observe(document.body, { childList: true, subtree: true });
    }

    // 4. åˆå§‹åŒ–ä¸‹æ‹‰èœå•äº¤äº’
    function initDropdownMenu() {
        const movieDropdown = document.querySelector('.movie-dropdown');
        const dropbtn = document.querySelector('.movie-dropdown .dropbtn');
        const dropdownContent = document.querySelector('.movie-dropdown .dropdown-content');
        
        if (movieDropdown && dropbtn && dropdownContent) {
            // ä¸ºä¸‹æ‹‰èœå•é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç¡®ä¿è·³è½¬æ­£å¸¸
            const dropdownItems = dropdownContent.querySelectorAll('a');
            dropdownItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // æ’­æ”¾éŸ³æ•ˆåè·³è½¬
                    playClickSound().then(() => {
                        window.location.href = this.getAttribute('href');
                    });
                });
            });
            
            // ç§»åŠ¨è®¾å¤‡ç‚¹å‡»å¤„ç†
            dropbtn.addEventListener('click', function(e) {
                if (window.innerWidth < 768) {
                    e.preventDefault();
                    dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
                }
            });
            
            // ç‚¹å‡»å…¶ä»–åŒºåŸŸå…³é—­èœå•
            document.addEventListener('click', function(e) {
                if (!movieDropdown.contains(e.target)) {
                    dropdownContent.style.display = 'none';
                }
            });
        }
    }

    // 5. åº§ä½åˆå§‹åŒ–ï¼šä¼˜åŒ–æœ€ä½³è§‚å½±åŒºæ ‡è¯†
    function initSeats() {
        const selectedSeats = [];
        const bestViewRows = ['B', 'C']; // æœ€ä½³è§‚å½±åŒºè¡Œ
        const rowCount = 5; // æ€»è¡Œæ•°
        const colCount = 10; // æ€»åˆ—æ•°

        // ç”Ÿæˆåº§ä½
        for (let row = 0; row < rowCount; row++) {
            const rowLabel = String.fromCharCode(65 + row); // A-Eæ’
            for (let col = 1; col <= colCount; col++) {
                const seatItem = document.createElement('li');
                seatItem.className = 'seat-item available';
                seatItem.textContent = rowLabel + col;
                seatItem.dataset.seat = rowLabel + col;

                // æ ‡è®°æœ€ä½³è§‚å½±åŒºåº§ä½
                if (bestViewRows.includes(rowLabel)) {
                    seatItem.classList.add('best-view');
                    seatItem.title = 'æœ€ä½³è§‚å½±åŒº';
                }

                // éšæœºç”Ÿæˆ30%å·²å”®åº§ä½ï¼ˆæ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼‰
                if (Math.random() < 0.3) {
                    seatItem.classList.remove('available');
                    seatItem.classList.add('sold');
                } else {
                    // å¯é€‰åº§ä½äº¤äº’
                    seatItem.addEventListener('click', () => {
                        // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                        playClickSound();

                        // åˆ‡æ¢é€‰ä¸­çŠ¶æ€
                        seatItem.classList.toggle('selected');
                        const seatId = seatItem.dataset.seat;

                        // æ›´æ–°é€‰ä¸­åˆ—è¡¨
                        if (seatItem.classList.contains('selected')) {
                            selectedSeats.push(seatId);
                        } else {
                            const index = selectedSeats.indexOf(seatId);
                            if (index > -1) {
                                selectedSeats.splice(index, 1);
                            }
                        }

                        // æ›´æ–°è®¢å•ä¿¡æ¯
                        updateOrderInfo(selectedSeats);
                    });
                }

                seatList.appendChild(seatItem);
            }
        }
    }

    // 6. æ›´æ–°è®¢å•ä¿¡æ¯ï¼šä¼˜åŒ–æ˜¾ç¤ºé€»è¾‘
    function updateOrderInfo(seats) {
        // åº§ä½æ˜¾ç¤ºï¼šè¶…è¿‡5ä¸ªæ—¶çœç•¥ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
        const seatText = seats.length > 0
            ? (seats.length > 5 ? `${seats.slice(0, 5).join(', ')}...` : seats.join(', '))
            : 'æœªé€‰æ‹©';
        seatNumbers.textContent = seatText;

        // ç¥¨æ•°/æ€»ä»·æ›´æ–°
        const ticketNum = seats.length;
        ticketCount.textContent = `${ticketNum}å¼ `;
        totalPrice.textContent = `Â¥${ticketNum * 50}`;

        // æŒ‰é’®çŠ¶æ€ï¼šæ— é€‰ä¸­æ—¶ç¦ç”¨
        buyButton.disabled = ticketNum === 0;
    }

    // 7. è´­ç¥¨é€»è¾‘ï¼šä¼˜åŒ–å¼¹çª—ä½“éªŒ
    function initPurchase() {
        buyButton.addEventListener('click', () => {
            const seats = seatNumbers.textContent;
            if (seats === 'æœªé€‰æ‹©' || seats === '') {
                alert('è¯·å…ˆé€‰æ‹©åº§ä½å†è´­ç¥¨å“¦ï½');
                return;
            }

            // æ’­æ”¾ç¡®è®¤éŸ³æ•ˆ
            playClickSound();

            // è´­ç¥¨æˆåŠŸå¼¹çª—ï¼ˆæ¸…æ™°åˆ†åŒºï¼‰
            const successMsg = `
è´­ç¥¨æˆåŠŸï¼ğŸ‰
ã€å½±ç‰‡ä¿¡æ¯ã€‘
å½±ç‰‡ï¼šã€Šå†°é›ªå¥‡ç¼˜2ã€‹
å½±å…ï¼š2å·å…
æ—¶é—´ï¼š12æœˆ1æ—¥ 21:00
ã€è®¢å•è¯¦æƒ…ã€‘
åº§ä½ï¼š${seatNumbers.textContent}
ç¥¨æ•°ï¼š${ticketCount.textContent}
æ€»ä»·ï¼š${totalPrice.textContent}
ã€å–ç¥¨æç¤ºã€‘
è¯·å‡­å–ç¥¨ç åœ¨å½±é™¢è‡ªåŠ©æœºå–ç¥¨
å¼€åœºå‰30åˆ†é’Ÿåˆ°å…å³å¯ï½
                `;
            alert(successMsg);

            // é‡ç½®çŠ¶æ€ï¼šæ¸…ç©ºé€‰ä¸­+æ›´æ–°è®¢å•
            const selectedSeats = document.querySelectorAll('.seat-item.selected');
            selectedSeats.forEach(seat => seat.classList.remove('selected'));
            updateOrderInfo([]);
        });
    }

    // 8. é¦–é¡µé“¾æ¥è·³è½¬å¤„ç†ï¼ˆä¿æŒéŸ³ä¹çŠ¶æ€ï¼‰
    function initHomeLink() {
        homeLink.addEventListener('click', (e) => {
            e.preventDefault();
            // ä¿å­˜å½“å‰éŸ³ä¹çŠ¶æ€åè·³è½¬
            localStorage.setItem('musicPlaying', backgroundMusic.paused ? 'false' : 'true');
            localStorage.setItem('musicTime', backgroundMusic.currentTime.toString());
            window.location.href = './index.html';
        });
    }

    // 9. é¡µé¢åŠ è½½å®Œæˆåç»Ÿä¸€åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        initMusic();              // åˆå§‹åŒ–èƒŒæ™¯éŸ³ä¹
        initGlobalClickSound();   // åˆå§‹åŒ–å…¨å±€ç‚¹å‡»éŸ³æ•ˆ
        initDropdownMenu();       // åˆå§‹åŒ–ä¸‹æ‹‰èœå•
        initSeats();              // åˆå§‹åŒ–åº§ä½é€‰æ‹©
        initPurchase();           // åˆå§‹åŒ–è´­ç¥¨åŠŸèƒ½
        initHomeLink();           // åˆå§‹åŒ–é¦–é¡µè·³è½¬
        buyButton.disabled = true;// åˆå§‹ç¦ç”¨è´­ç¥¨æŒ‰é’®
    });
</script>
<script src="js/index.js"></script>
<script src="js/daojishi.js"></script>
</body>
</html>
    